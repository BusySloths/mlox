# cloud-config

package_update: true
packages:
  - openssh-server

ssh_pwauth: true

users:
  - name: root
    lock_passwd: false
    plain_text_passwd: "pass"
    shell: /bin/bash

chpasswd:
  list: |
    root:pass
  expire: false

runcmd:
  - sed -i 's/^#\?PermitRootLogin .*/PermitRootLogin yes/' /etc/ssh/sshd_config
  - sed -i 's/^#\?PasswordAuthentication .*/PasswordAuthentication yes/' /etc/ssh/sshd_config
  - sed -i 's/^#\?Port .*/Port 22/' /etc/ssh/sshd_config
  - bash -c 'if command -v ufw >/dev/null 2>&1; then ufw --force disable; fi'
  - bash -c 'systemctl enable ssh 2>/dev/null || systemctl enable sshd'
  - bash -c 'systemctl restart ssh 2>/dev/null || systemctl restart sshd'
